{% extends "base.html" %}

{% block styles %}
<style>
body {
  margin: 0;
  height: 100vh;
  overflow-x: hidden;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg, #e9fce7 0%, #f5fff8 60%, #ffffff 100%);
}

/* âœ… Nature Background (NO SUN) */
.nature-bg {
  position: fixed;
  inset: 0;
  z-index: 0;
  background: linear-gradient(180deg, #c8f8d2 0%, #ecfdf5 50%, #ffffff 100%);
  overflow: hidden;
}

/* âœ… Floating Leaf Particles ðŸŒ¿ */
.particle {
  position: absolute;
  bottom: -20px;
  width: 14px;
  height: 14px;
  border-radius: 3px;
  background: rgba(34, 197, 94, 0.25);
  transform: rotate(45deg);
  animation: floatUp 12s linear infinite;
  filter: blur(0.5px);
}
.particle.delay1 { left: 45%; animation-delay: 3s; }
.particle.delay2 { left: 70%; animation-delay: 6s; }

/* âœ… Standard Card */
.card {
  background: white;
  border-radius: 1rem;
  border: 1px solid #e2e8f0;
  box-shadow: 0 8px 25px rgba(0,0,0,0.06);
  transition: 0.3s;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(0,0,0,0.10);
}

/* âœ… Animations */
@keyframes floatUp {
  0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
  50% { transform: translateY(-50vh) rotate(40deg); opacity: 0.5; }
  100% { transform: translateY(-100vh) rotate(70deg); opacity: 0; }
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes slideIn {
  from { opacity: 0; transform: translateX(40px); }
  to { opacity: 1; transform: translateX(0); }
}

.animate-fadeIn { animation: fadeIn 1s ease-out forwards; }
.animate-slideIn { animation: slideIn 1s ease-out forwards; }

/* âœ… Compact top cards */
.small-card {
  height: 155px;
  display: flex;
  justify-content: center;
  flex-direction: column;
}
</style>
{% endblock %}

{% block content %}

<!-- âœ… Background (Only Leaves, No Sun) -->
<div class="nature-bg">
  <div class="particle"></div>
  <div class="particle delay1"></div>
  <div class="particle delay2"></div>
</div>

<!-- âœ… Main Content -->
<div class="max-w-7xl mx-auto px-6 relative z-10">

  <div class="text-center mt-4 mb-10 animate-fadeIn">
      <h1 class="text-4xl font-extrabold text-gray-800 drop-shadow">
        Analysis <span class="text-emerald-600">Results</span>
      </h1>
      <p class="text-gray-600 mt-2">Processed image with AI-based archaeological mapping</p>
  </div>

  <!-- âœ… First Row -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">

      <div class="card p-5 small-card animate-fadeIn">
        <h2 class="text-lg font-semibold text-emerald-700 mb-1">Summary</h2>
        <p class="text-sm"><b>Model:</b> {{ stats.model_used }}</p>
        <p class="text-sm"><b>Detections:</b> {{ stats.detections }}</p>
        <p class="text-sm"><b>Highest Confidence:</b> {{ stats.highest_confidence }}</p>
        <p class="text-sm"><b>IoU Threshold:</b> {{ stats.iou_threshold }}</p>
        <p class="text-sm"><b>Conf Threshold:</b> {{ stats.conf_threshold }}</p>
      </div>

      <div class="card p-5 small-card animate-slideIn">
        <h2 class="text-sm text-emerald-700 font-semibold">Highest Confidence</h2>
        <p class="text-4xl font-extrabold text-gray-800">
          {{ (stats.highest_confidence * 100) | round(1) }}%
        </p>
      </div>

      <div class="card p-5 small-card animate-slideIn">
        <h2 class="text-sm text-emerald-700 font-semibold">Objects Detected</h2>
        <p class="text-4xl font-extrabold text-gray-800">{{ stats.detections }}</p>
      </div>

      <!-- âœ… NEW â€” SHOW DETECTED SOIL / VEGETATION NAMES -->
      <div class="card p-5 small-card animate-slideIn">
        <h2 class="text-sm text-emerald-700 font-semibold">Detected Classes</h2>
        <p class="text-md font-semibold text-gray-700">
            {% if stats.class_names %}
                {{ stats.class_names | join(', ') }}
            {% else %}
                None
            {% endif %}
        </p>
      </div>

  </div>

  <!-- âœ… Images -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-10">

    <div class="card p-3 animate-fadeIn">
      <h2 class="text-lg font-semibold text-emerald-700 mb-2">Original Image</h2>
      <div onclick="openLightbox(this.querySelector('img').src)"
           class="rounded-xl overflow-hidden shadow cursor-pointer">
        <img src="{{ url_for('static', filename=original) }}" class="w-full h-64 object-cover" />
      </div>
    </div>

    <div class="card p-3 animate-slideIn">
      <h2 class="text-lg font-semibold text-emerald-700 mb-2">Detection Result</h2>
      <div onclick="openLightbox(this.querySelector('img').src)"
           class="rounded-xl overflow-hidden shadow cursor-pointer">
        <img src="{{ url_for('static', filename=result) }}" class="w-full h-64 object-cover" />
      </div>
    </div>

    <div class="card p-3 animate-slideIn">
      <h2 class="text-lg font-semibold text-emerald-700 mb-2">Segmentation Mask</h2>
      <div onclick="openLightbox(this.querySelector('img').src)"
           class="rounded-xl overflow-hidden shadow cursor-pointer">
        <img src="{{ url_for('static', filename=segmented) }}" class="w-full h-64 object-cover" />
      </div>
    </div>

  </div>

</div>

<!-- âœ… Lightbox -->
<div id="lightbox"
     class="fixed inset-0 bg-black/85 hidden items-center justify-center z-50"
     onclick="closeLightbox()">
  <img id="lightbox-img" class="max-w-[90vw] max-h-[90vh] rounded-xl shadow-2xl" />
</div>

{% endblock %}

{% block scripts %}
<script>
function openLightbox(src) {
    document.getElementById("lightbox-img").src = src;
    let lb = document.getElementById("lightbox");
    lb.classList.remove("hidden");
    lb.classList.add("flex");

    document.querySelector("header").style.opacity = "0";
    document.querySelector("footer").style.opacity = "0";
}

function closeLightbox() {
    document.getElementById("lightbox").classList.add("hidden");

    document.querySelector("header").style.opacity = "1";
    document.querySelector("footer").style.opacity = "1";
}
</script>
{% endblock %}
