{% extends 'base.html' %}
{% block content %}

<!-- ✅ Nature Background Theme -->
<div class="nature-bg">
  <div class="particle"></div>
  <div class="particle delay1"></div>
  <div class="particle delay2"></div>
</div>

<!-- ✅ Compact Wrapper -->
<div class="max-w-7xl mx-auto px-6 py-4 relative z-10">

    <!-- ✅ Title -->
    <div class="text-center mb-4 animate-fadeIn">
        <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">
            AI Comparison <span class="text-emerald-600">Report</span>
        </h1>
        <p class="text-gray-600 text-sm mt-1">Side-by-side evaluation of two inputs</p>
    </div>

    <!-- ✅ THEMED WHITE MAIN CARD -->
    <div class="bg-white border border-gray-200 rounded-2xl shadow-xl p-6 mx-auto"
         style="max-height: 580px;">

        <div class="grid grid-cols-3 gap-6">

            <!-- ✅ IMAGE 1 CARD -->
            <div class="bg-gray-50 border rounded-xl p-4 shadow-sm flex flex-col">
                <h2 class="font-semibold text-lg text-gray-800 text-center mb-3">Image 1</h2>

                <div class="flex-1 flex justify-center items-center">
                    <img src="{{ url_for('static', filename=file1) }}"
                         class="w-full h-68 md:h-80 object-cover rounded-xl" />
                </div>

                <div class="mt-3 text-xs text-gray-700">
                    <p><b>Detections:</b> {{ comparison.detections_1 }}</p>
                    <p><b>Confidence:</b> {{ (comparison.highest_conf_1 * 100) | round(1) }}%</p>

                    {% if is_soil %}
                    <p><b>Soil Type:</b> {{ comparison.soil_name_1 }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- ✅ SUMMARY COLUMN (CENTER) -->
            <div class="bg-white border rounded-xl p-4 shadow-lg">

                <h2 class="text-xl font-bold text-center text-emerald-700 mb-4">Summary</h2>

                <div class="space-y-3 text-sm text-gray-800">

                    <div class="flex justify-between border-b pb-1">
                        <span>Detection Change</span>
                        <span class="font-semibold">
                            {% if comparison.difference > 0 %}+{{ comparison.difference }}
                            {% else %}{{ comparison.difference }}{% endif %}
                        </span>
                    </div>

                    {% set conf_change = comparison.highest_conf_2 - comparison.highest_conf_1 %}
                    {% set pct = (conf_change * 100) | round(1) %}

                    <div class="flex justify-between border-b pb-1">
                        <span>Confidence Change</span>
                        <span class="{% if pct > 0 %}text-emerald-600{% elif pct < 0 %}text-red-500{% endif %} font-semibold">
                            {% if pct > 0 %}+{{ pct }}%
                            {% else %}{{ pct }}%
                            {% endif %}
                        </span>
                    </div>

                    <div class="flex justify-between border-b pb-1">
                        <span>Model Used</span>
                        <span>{{ comparison.model_used }}</span>
                    </div>

                    <div class="flex justify-between border-b pb-1">
                        <span>IOU Threshold</span>
                        <span>{{ comparison.iou_threshold }}</span>
                    </div>

                    <div class="flex justify-between border-b pb-1">
                        <span>Confidence Threshold</span>
                        <span>{{ comparison.conf_threshold }}</span>
                    </div>

                </div>

                <!-- ✅ Interpretation -->
                <div class="mt-6 text-center text-gray-700 text-sm">
                    {% if pct > 0 %}
                    Image 2 shows improved confidence.
                    {% elif pct < 0 %}
                    Image 1 shows stronger detection confidence.
                    {% else %}
                    Both images show equal confidence.
                    {% endif %}
                </div>

                <!-- ✅ Buttons -->
                <div class="mt-5 text-center">
                    <a href="{{ url_for('compare') }}"
                       class="px-4 py-1.5 text-sm bg-emerald-600 text-white rounded-lg shadow hover:bg-emerald-700 transition">
                       Compare Again
                    </a>

                    <a href="{{ url_for('upload') }}"
                       class="ml-3 px-4 py-1.5 text-sm bg-gray-200 text-gray-800 rounded-lg shadow hover:bg-gray-300 transition">
                       Upload New
                    </a>
                </div>

            </div>

            <!-- ✅ IMAGE 2 CARD -->
            <div class="bg-gray-50 border rounded-xl p-4 shadow-sm flex flex-col">
                <h2 class="font-semibold text-lg text-gray-800 text-center mb-3">Image 2</h2>

                <div class="flex-1 flex justify-center items-center">
                    <img src="{{ url_for('static', filename=file2) }}"
                         class="w-full h-68 md:h-80 object-cover rounded-xl" />
                </div>

                <div class="mt-3 text-xs text-gray-700">
                    <p><b>Detections:</b> {{ comparison.detections_2 }}</p>
                    <p><b>Confidence:</b> {{ (comparison.highest_conf_2 * 100) | round(1) }}%</p>

                    {% if is_soil %}
                    <p><b>Soil Type:</b> {{ comparison.soil_name_2 }}</p>
                    {% endif %}
                </div>
            </div>

        </div>

    </div>
</div>

<style>
/* ✅ Match your theme exactly */
.nature-bg {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg, #dffae3 0%, #f4fffa 60%, #ffffff 100%);
  z-index: 0;
  overflow: hidden;
}
.particle {
  position: absolute;
  bottom: -20px;
  width: 14px;
  height: 14px;
  border-radius: 3px;
  background: rgba(44, 176, 104, 0.25);
  animation: floatUp 12s linear infinite;
  transform: rotate(45deg);
}
.particle.delay1 { left: 40%; animation-delay: 3s; }
.particle.delay2 { left: 70%; animation-delay: 6s; }

@keyframes floatUp {
  0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
  50% { transform: translateY(-45vh) rotate(40deg); opacity: 0.5; }
  100% { transform: translateY(-90vh) rotate(70deg); opacity: 0; }
}
</style>

{% endblock %}
